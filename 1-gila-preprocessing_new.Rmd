---
title: "Upper Gila Watershed Preprocessing"
author: "Lauren Victoria Jaramillo, UNM (alwayslo@unm.edu)"
date: "4/29/2019"
output: html_notebook
---
created:11/29/2018

This R notebook is used to process the existing hydrology (Gila at Gila River USGS gage No.09430500). Conditional probabilities for inundation and recession rates are calculated in this script. Recession rates were calculated using information for site 1 only for this recreation of the historical model/process. USGS data was used to generate conditional probabilities and scenario data was used to generate evidence.

This first code chunck clears the environment, installs all the necessary packages, and returns the current working directory to ensure filespaths will execute properly.
```{r}
rm(list=ls())
library("xts")
library("prob")
library("TTR")
library("bigmemory")
library("zoo")
library("raster")
library("sp")
library("rgdal")
library("rasterVis")
library("ggplot2")
library("rgdal")
library("dplyr")

getwd()
```
#Conditional Probabilities#
#### Process USGS hydrology data ####
The hydrologic historical data for the Gila River is located in usgs_09430500_daily.txt. Units are cfs. This code chunk loads usgs_09430500_daily.txt and uses it to create a dataframe called usgs_hydro.
```{r}
usgs_hydro <- read.csv("data/usgs_09430500_daily.txt", skip=27,header = TRUE, sep = "")
usgs_hydro <- setNames(usgs_hydro,c("agency","site_no","date","flowrate (cfs)","code"))
usgs_hydro$date<-as.Date(usgs_hydro$date, format="%Y-%m-%d")
```

This project includes three study sites. This code chunck adds the stage (both ft and cm) for each site based on the flowrate and previously developed regression equations for each site (1-North,2- Middle,3- South).

North, Depth = 0.0003Q + 2
Middle, Depth = 0.0004Q + 2.1
South, Depth = 0.0003Q + 1.2

SPECIFY SITE
##Site 1## 
```{r}
stage <- data.frame(0.0003*usgs_hydro[4]+2)
stage <- setNames(stage, "stage (ft)")

stage_cm <- data.frame(stage[1]*30.48)
stage_cm <- setNames(stage_cm,"stage (cm)")
```

##Site 2## 
```{r}
stage <- data.frame(0.0004*usgs_hydro[4]+2.1)
stage <- setNames(stage_s2, "stage (ft)")

stage_cm <- data.frame(stage_s2[1]*30.48)
stage_cm <- setNames(stage_cm_s2,"stage (cm)")
```

##Site 3## 
```{r}
stage <- data.frame(0.0003*(usgs_hydro[4]+1.2))
stage <- setNames(stage_s3,"stage (ft)")

stage_cm <- data.frame(stage_s3[1]*30.48)
stage_cm <- setNames(stage_cm_s3,"stage (cm)")
```

#### Calculate recession rates ####
Calculates the 14-day recession rate (cm/day). Recession rate (forward) was calculated using a 14 day average based on the site specified above. The equation was mimicing that of Morrison & Stone (2014).

*hind? 13+i - i.... is that a better representation?
```{r}
# average_stage_14_day <-sum(stage_cm[1:14,1])/14
# recession_rate_14_day <- (stage_cm[1,1] - stage_cm[14,1])/14

usgs_recessionrate_14d<- data.frame()

for (i in 1:(nrow(stage_cm))) 
  {usgs_recessionrate_14d <- rbind(usgs_recessionrate_14d,(stage_cm[i,1]-stage_cm[13+i,1])/14)}

usgs_recessionrate_14d <- cbind(usgs_hydro[,3],usgs_recessionrate_14d)
usgs_recessionrate_14d <- setNames(usgs_recessionrate_14d,c("date","recessionrate (cm/d)"))
usgs_recessionrate_14d<-na.omit(usgs_recessionrate_14d)
```


#### Process Q-model bins ####
Establishes model q-bins and calculates the probability of discharge range for any given entire year and discrete time state (April-May, June-July, August-September).Model Q-bins were selected so that inundation areas increased by less than 15% between the discharge associated with each bin (i.e. 1000 cfs, 1500 cfs, 2000 cfs, 2500 cfs, 3000 cfs, 3500 cfs, 4000 cfs). 

```{r}
q_bin <- c(1000, 1500, 2000, 2500, 3000, 3500, 4000)

```

Calculates the annual probability of a bin flood event occuring for the historical dataset (usgs) excluding flow events less than the minimum innundation value. Essentially only capturing the probability of events that would innundate the floodplain/riparian zone by removing flow events that are less than that of the lower boundary of flow bin 1.
```{r}
q_bin_usgs <-cbind.data.frame(usgs_hydro$date,
              q_bin_0 <- usgs_hydro[,4]< q_bin[1],
              q_bin_1 <- q_bin[1]<= usgs_hydro[,4] & usgs_hydro[,4]<q_bin[2],
              q_bin_2 <- q_bin[2]<= usgs_hydro[,4] & usgs_hydro[,4]<q_bin[3],
              q_bin_3 <- q_bin[3]<= usgs_hydro[,4] & usgs_hydro[,4]<q_bin[4],
              q_bin_4 <- q_bin[4]<= usgs_hydro[,4] & usgs_hydro[,4]<q_bin[5],
              q_bin_5 <- q_bin[5]<= usgs_hydro[,4] & usgs_hydro[,4]<q_bin[6],
              q_bin_6 <- q_bin[6]<= usgs_hydro[,4] & usgs_hydro[,4]<q_bin[7],
              q_bin_7 <- usgs_hydro[,4]>q_bin[7])

colnames(q_bin_usgs) <- c("date","q_bin_0","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_usgs_yr <- cbind(length(which(q_bin_1))/(length(q_bin_1)-length(which(q_bin_0))),
                                       length(which(q_bin_2))/(length(q_bin_2)-length(which(q_bin_0))),
                                       length(which(q_bin_3))/(length(q_bin_3)-length(which(q_bin_0))),
                                       length(which(q_bin_4))/(length(q_bin_4)-length(which(q_bin_0))),
                                       length(which(q_bin_5))/(length(q_bin_5)-length(which(q_bin_0))),
                                       length(which(q_bin_6))/(length(q_bin_6)-length(which(q_bin_0))),
                                       length(which(q_bin_7))/(length(q_bin_7)-length(which(q_bin_0))))

colnames(q_prob_usgs_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")
row.names(q_prob_usgs_yr) <- c("q_prob")
```

Calculates the probability of a bin flood event occuring for historical dataset (usgs) for discrete time states (April-May, June-July, August-September). Each flow scenario corrects the probability distribution for error by normalizing the probabilities (i.e. ensuring the distribution sums to 1).
```{r}
apr_may_bin <- q_bin_usgs[months(q_bin_usgs$date) %in% month.name[4:5],]
jun_jul_bin <- q_bin_usgs[months(q_bin_usgs$date) %in% month.name[6:7],]
aug_sep_bin <- q_bin_usgs[months(q_bin_usgs$date) %in% month.name[8:9],]

q_prob_usgs_apr_may <- cbind(length(which(apr_may_bin$q_bin_1))/(length(apr_may_bin$q_bin_1)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_2))/(length(apr_may_bin$q_bin_2)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_3))/(length(apr_may_bin$q_bin_3)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_4))/(length(apr_may_bin$q_bin_4)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_5))/(length(apr_may_bin$q_bin_5)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_6))/(length(apr_may_bin$q_bin_6)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_7))/(length(apr_may_bin$q_bin_7)-length(which(apr_may_bin$q_bin_0))))

colnames(q_prob_usgs_apr_may) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_usgs_jun_jul <- cbind(length(which(jun_jul_bin$q_bin_1))/(length(jun_jul_bin$q_bin_1)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_2))/(length(jun_jul_bin$q_bin_2)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_3))/(length(jun_jul_bin$q_bin_3)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_4))/(length(jun_jul_bin$q_bin_4)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_5))/(length(jun_jul_bin$q_bin_5)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_6))/(length(jun_jul_bin$q_bin_6)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_7))/(length(jun_jul_bin$q_bin_7)-length(which(jun_jul_bin$q_bin_0))))

colnames(q_prob_usgs_jun_jul) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_usgs_aug_sep <- cbind(length(which(aug_sep_bin$q_bin_1))/(length(aug_sep_bin$q_bin_1)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_2))/(length(aug_sep_bin$q_bin_2)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_3))/(length(aug_sep_bin$q_bin_3)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_4))/(length(aug_sep_bin$q_bin_4)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_5))/(length(aug_sep_bin$q_bin_5)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_6))/(length(aug_sep_bin$q_bin_6)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_7))/(length(aug_sep_bin$q_bin_7)-length(which(aug_sep_bin$q_bin_0))))

colnames(q_prob_usgs_aug_sep) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_usgs_discrete <- rbind(q_prob_usgs_apr_may,q_prob_usgs_jun_jul,q_prob_usgs_aug_sep)
row.names(q_prob_usgs_discrete) <- c("apr_may","jun_jul","aug_sep")
q_prob_usgs_discrete <- q_prob_usgs_discrete/rowSums(q_prob_usgs_discrete)
```

#### Process recession rate bins ####
Establishes model recession rate bins and calculates the probability of recession rate ranges for 14-day and 30-day recession rates for any given entire year and discrete time state (April-May, June-July, August-September).

Recession rate bins were selected so that .....???? (i.e. 0 cm/day, 1 cm/day, 3 cm/day, 6 cm/day).
```{r}
recessionrate_bin <- c(0,1,3,6)
```

## 14-day recession rate bin and probabilities##

Bins the 14-day recession rates for the historical dataset (usgs) and calculates the probability of the recession rate range for any given year.
```{r}
a <- usgs_recessionrate_14d[2]
b <- usgs_recessionrate_14d[1]

rr_14d_bin_usgs <-cbind( usgs_recessionrate_14d[1], recessionrate_bin_1 <- a <= recessionrate_bin[1],
              recessionrate_bin_2 <- recessionrate_bin[1]< a & a <=recessionrate_bin[2],
              recessionrate_bin_3 <- recessionrate_bin[2]< a & a <=recessionrate_bin[3],
              recessionrate_bin_4 <- recessionrate_bin[3]< a & a <=recessionrate_bin[4],
              recessionrate_bin_5 <- a > recessionrate_bin[4])

colnames(rr_14d_bin_usgs) <- c("date",
                                  "recessionrate_bin_1",
                                  "recessionrate_bin_2",
                                  "recessionrate_bin_3",
                                  "recessionrate_bin_4",
                                  "recessionrate_bin_5")

rr_14d_prob_usgs_yr <-cbind(length(which(recessionrate_bin_1))/length(recessionrate_bin_1),
                                       length(which(recessionrate_bin_2))/length(recessionrate_bin_2),
                                       length(which(recessionrate_bin_3))/length(recessionrate_bin_3),
                                       length(which(recessionrate_bin_4))/length(recessionrate_bin_4),
                                       length(which(recessionrate_bin_5))/length(recessionrate_bin_5))

colnames(rr_14d_prob_usgs_yr) <- c("recessionrate_bin_1",
                                        "recessionrate_bin_2",
                                        "recessionrate_bin_3",
                                        "recessionrate_bin_4",
                                        "recessionrate_bin_5")

```

Calculates the probability of 14-day recession rate ranges for the historical dataset (usgs) and discrete time state (April-May, June-July, August-September).
```{r}

apr_may_bin <- rr_14d_bin_usgs[months(rr_14d_bin_usgs$date) %in% month.name[4:5],]
jun_jul_bin <- rr_14d_bin_usgs[months(rr_14d_bin_usgs$date) %in% month.name[6:7],]
aug_sep_bin <- rr_14d_bin_usgs[months(rr_14d_bin_usgs$date) %in% month.name[8:9],]

rr_14d_prob_usgs_apr_may <- cbind(length(which(apr_may_bin$recessionrate_bin_1))/length(apr_may_bin$recessionrate_bin_1),
                                       length(which(apr_may_bin$recessionrate_bin_2))/length(apr_may_bin$recessionrate_bin_2),
                                       length(which(apr_may_bin$recessionrate_bin_3))/length(apr_may_bin$recessionrate_bin_3),
                                       length(which(apr_may_bin$recessionrate_bin_4))/length(apr_may_bin$recessionrate_bin_4),
                                       length(which(apr_may_bin$recessionrate_bin_5))/length(apr_may_bin$recessionrate_bin_5))

colnames(rr_14d_prob_usgs_apr_may) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_usgs_jun_jul <- cbind(length(which(jun_jul_bin$recessionrate_bin_1))/length(jun_jul_bin$recessionrate_bin_1),
                                       length(which(jun_jul_bin$recessionrate_bin_2))/length(jun_jul_bin$recessionrate_bin_2),
                                       length(which(jun_jul_bin$recessionrate_bin_3))/length(jun_jul_bin$recessionrate_bin_3),
                                       length(which(jun_jul_bin$recessionrate_bin_4))/length(jun_jul_bin$recessionrate_bin_4),
                                       length(which(jun_jul_bin$recessionrate_bin_5))/length(jun_jul_bin$recessionrate_bin_5))

colnames(rr_14d_prob_usgs_jun_jul) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_usgs_aug_sep <- cbind(length(which(aug_sep_bin$recessionrate_bin_1))/length(aug_sep_bin$recessionrate_bin_1),
                                       length(which(aug_sep_bin$recessionrate_bin_2))/length(aug_sep_bin$recessionrate_bin_2),
                                       length(which(aug_sep_bin$recessionrate_bin_3))/length(aug_sep_bin$recessionrate_bin_3),
                                       length(which(aug_sep_bin$recessionrate_bin_4))/length(aug_sep_bin$recessionrate_bin_4),
                                       length(which(aug_sep_bin$recessionrate_bin_5))/length(aug_sep_bin$recessionrate_bin_5))

colnames(rr_14d_prob_usgs_aug_sep) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_usgs_discrete <- rbind(rr_14d_prob_usgs_apr_may,rr_14d_prob_usgs_jun_jul,rr_14d_prob_usgs_aug_sep)
row.names(rr_14d_prob_usgs_discrete) <- c("apr_may","jun_jul","aug_sep")
rr_14d_prob_usgs_discrete <- rr_14d_prob_usgs_discrete/rowSums(rr_14d_prob_usgs_discrete)
```


#### Calculate probabilities for bed shear/scour####
To be potential developed once historical model/process has been recreated.
```{r}



```

#### Calculate probabilities for gw ####
To be potential developed once historical model/process has been recreated.
```{r}



```
---------------------------------------------------------------------------------------------------------------------------------
#Evidence#
#### Process CUFA hydrology data ####
The hydrologic historical data for the Gila River is located in scenario_new.csv and includes the natural, current operations, combined operations (Upper Gila + Fort West & Cliff-Gila Ditch), and combined operations + AWSA (Arizona Water Settlement Act). This code chunk loads scenario_new.csv and uses it to create a dataframe called hydro.
```{r}
hydro <- read.csv("data/scenarios_new.csv", skip=1,header = TRUE)
hydro <- setNames(hydro, c("date","natural", "current_operations","combined_operations","combined_operations+AWSA"))
hydro$date<-as.Date(hydro$date, format="%m/%d/%Y")
```

This project includes three study sites. This code chunck adds the stage (both ft and cm) for each site based on the flowrate and previously developed regression equations for each site. The hydro column called must correspond with each scenario (i.e.1-natural, 2-current operations, 3-combined operations (Upper Gila + Fort West & Cliff-Gila Ditch), and 4-combined operations + AWSA (Arizona Water Settlement Act).

SPECIFY SITE

###Site 1###
```{r}
head_conv <- data.frame(hydro$date,0.0003*hydro[2]+2, 0.0003*hydro[3]+2,0.0003*hydro[4]+2,0.0003*hydro[5]+2)
head_conv <- setNames(head_conv, c("date","natural(ft)", "current_operations(ft)","combined_operations(ft)","combined_operations+AWSA(ft)"))

head_cm <- data.frame(hydro$date,head_conv[2]*30.48,head_conv[3]*30.48,head_conv[4]*30.48,head_conv[5]*30.48)
head_cm <- setNames(head_cm,c("date","natural(cm)", "current_operations(cm)","combined_operations(cm)","combined_operations+AWSA(cm)"))
```


###Site 2###
```{r}
head_conv <- data.frame(hydro$date,0.0004*hydro[2]+2.1, 0.0004*hydro[3]+2.1,0.0004*hydro[4]+2.1,0.0004*hydro[5]+2.1)
head_conv <- setNames(head_conv, c("date","natural(ft)", "current_operations(ft)","combined_operations(ft)","combined_operations+AWSA(ft)"))

head_cm <- data.frame(hydro$date,head_conv[2]*30.48,head_conv[3]*30.48,head_conv[4]*30.48,head_conv[5]*30.48)
head_cm <- setNames(head_cm,c("date","natural(cm)", "current_operations(cm)","combined_operations(cm)","combined_operations+AWSA(cm)"))
```

###Site 3###
```{r}
head_conv <- data.frame(hydro[1],0.0003*hydro[2]+1.2, 0.0003*hydro[3]+1.2,0.0003*hydro[4]+1.2,0.0003*hydro[5]+1.2)
head_conv <- setNames(head_conv, c("date","natural(ft)", "current_operations(ft)","combined_operations(ft)","combined_operations+AWSA(ft)"))

head_cm <- data.frame(hydro$date,head_conv[2]*30.48,head_conv[3]*30.48,head_conv[4]*30.48,head_conv[5]*30.48)
head_cm <- setNames(head_cm,c("date","natural(cm)", "current_operations(cm)","combined_operations(cm)","combined_operations+AWSA(cm)"))
```


#### Calculate recession rates ####
Calculates the 14-day recession rate (cm/day). Recession rate (forward) was calculated using a 14 day average based on the site specified above). The equation was mimicing that of Morrison & Stone (2014).
```{r}
# average_natural_stage_14_day <-sum(head_cm[1:14,1])/14
# recession_rate_natural_14_day <- (head_cm[1,1] - head_cm[14,1])/14

recessionrate_14d<- data.frame()

for (i in 1:(nrow(head_cm))) 
  {recessionrate_14d <- rbind(recessionrate_14d,c((head_cm[i,2]-head_cm[13+i,2])/14,
                                                  (head_cm[i,3]-head_cm[13+i,3])/14,
                                                  (head_cm[i,4]-head_cm[13+i,4])/14,
                                                  (head_cm[i,5]-head_cm[13+i,5])/14))}

recessionrate_14d <- cbind(hydro[,1],recessionrate_14d)
recessionrate_14d <- setNames(recessionrate_14d,c("date",
                                                  "natural(cm/d)",
                                                  "current_operations(cm/d)",
                                                  "combined_operations(cm/d)",
                                                  "combined_operations+AWSA(cm/d)"))
recessionrate_14d<-na.omit(recessionrate_14d)
```

#### Process Q-model bins ####
Establishes model q-bins and calculates the probability of discharge range for any given entire year and discrete time state (April-May, June-July, August-September).Model Q-bins were selected so that inundation areas increased by less than 15% between the discharge associated with each bin (i.e. 1000 cfs, 1500 cfs, 2000 cfs, 2500 cfs, 3000 cfs, 3500 cfs, 4000 cfs). 

Calculates the annual probability of a bin flood event occuring for all four flow scenarios(i.e.1-natural, 2-current operations, 3-combined operations (Upper Gila + Fort West & Cliff-Gila Ditch), and 4-combined operations + AWSA (Arizona Water Settlement Act).
```{r}
q_bin_natural <-cbind.data.frame(hydro$date,
              q_bin_0 <- hydro[,2]< q_bin[1],
              q_bin_1 <- q_bin[1]<= hydro[,2] & hydro[,2]<q_bin[2],
              q_bin_2 <- q_bin[2]<= hydro[,2] & hydro[,2]<q_bin[3],
              q_bin_3 <- q_bin[3]<= hydro[,2] & hydro[,2]<q_bin[4],
              q_bin_4 <- q_bin[4]<= hydro[,2] & hydro[,2]<q_bin[5],
              q_bin_5 <- q_bin[5]<= hydro[,2] & hydro[,2]<q_bin[6],
              q_bin_6 <- q_bin[6]<= hydro[,2] & hydro[,2]<q_bin[7],
              q_bin_7 <- hydro[,2]>q_bin[7])

colnames(q_bin_natural) <- c("date","q_bin_0","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_natural_yr <- cbind(length(which(q_bin_1))/(length(q_bin_1)-length(which(q_bin_0))),
                                       length(which(q_bin_2))/(length(q_bin_2)-length(which(q_bin_0))),
                                       length(which(q_bin_3))/(length(q_bin_3)-length(which(q_bin_0))),
                                       length(which(q_bin_4))/(length(q_bin_4)-length(which(q_bin_0))),
                                       length(which(q_bin_5))/(length(q_bin_5)-length(which(q_bin_0))),
                                       length(which(q_bin_6))/(length(q_bin_6)-length(which(q_bin_0))),
                                      length(which(q_bin_7))/(length(q_bin_7)-length(which(q_bin_0))))

colnames(q_prob_natural_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")
row.names(q_prob_natural_yr) <- c("q_prob")

q_bin_scenario1 <-cbind.data.frame(hydro$date,
              q_bin_0 <- hydro[,3]< q_bin[1],
              q_bin_1 <- q_bin[1]<= hydro[,3] & hydro[,3]<q_bin[2],
              q_bin_2 <- q_bin[2]<= hydro[,3] & hydro[,3]<q_bin[3],
              q_bin_3 <- q_bin[3]<= hydro[,3] & hydro[,3]<q_bin[4],
              q_bin_4 <- q_bin[4]<= hydro[,3] & hydro[,3]<q_bin[5],
              q_bin_5 <- q_bin[5]<= hydro[,3] & hydro[,3]<q_bin[6],
              q_bin_6 <- q_bin[6]<= hydro[,3] & hydro[,3]<q_bin[7],
              q_bin_7 <- hydro[,3]>q_bin[7])

colnames(q_bin_scenario1) <- c("date","q_bin_0","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_scenario1_yr <- cbind(length(which(q_bin_1))/(length(q_bin_1)-length(which(q_bin_0))),
                                       length(which(q_bin_2))/(length(q_bin_2)-length(which(q_bin_0))),
                                       length(which(q_bin_3))/(length(q_bin_3)-length(which(q_bin_0))),
                                       length(which(q_bin_4))/(length(q_bin_4)-length(which(q_bin_0))),
                                       length(which(q_bin_5))/(length(q_bin_5)-length(which(q_bin_0))),
                                       length(which(q_bin_6))/(length(q_bin_6)-length(which(q_bin_0))),
                                      length(which(q_bin_7))/(length(q_bin_7)-length(which(q_bin_0))))

colnames(q_prob_scenario1_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")
row.names(q_prob_scenario1_yr) <- c("q_prob")

q_bin_scenario2 <-cbind.data.frame(hydro$date,
              q_bin_0 <- hydro[,4]< q_bin[1],
              q_bin_1 <- q_bin[1]<= hydro[,4] & hydro[,4]<q_bin[2],
              q_bin_2 <- q_bin[2]<= hydro[,4] & hydro[,4]<q_bin[3],
              q_bin_3 <- q_bin[3]<= hydro[,4] & hydro[,4]<q_bin[4],
              q_bin_4 <- q_bin[4]<= hydro[,4] & hydro[,4]<q_bin[5],
              q_bin_5 <- q_bin[5]<= hydro[,4] & hydro[,4]<q_bin[6],
              q_bin_6 <- q_bin[6]<= hydro[,4] & hydro[,4]<q_bin[7],
              q_bin_7 <- hydro[,4]>q_bin[7])

colnames(q_bin_scenario2) <- c("date","q_bin_0","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_scenario2_yr <- cbind(length(which(q_bin_1))/(length(q_bin_1)-length(which(q_bin_0))),
                                       length(which(q_bin_2))/(length(q_bin_2)-length(which(q_bin_0))),
                                       length(which(q_bin_3))/(length(q_bin_3)-length(which(q_bin_0))),
                                       length(which(q_bin_4))/(length(q_bin_4)-length(which(q_bin_0))),
                                       length(which(q_bin_5))/(length(q_bin_5)-length(which(q_bin_0))),
                                       length(which(q_bin_6))/(length(q_bin_6)-length(which(q_bin_0))),
                                      length(which(q_bin_7))/(length(q_bin_7)-length(which(q_bin_0))))

colnames(q_prob_scenario2_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")
row.names(q_prob_scenario2_yr) <- c("q_prob")

q_bin_scenario3 <-cbind.data.frame(hydro$date,
              q_bin_0 <- hydro[,5]< q_bin[1],
              q_bin_1 <- q_bin[1]<= hydro[,5] & hydro[,5]<q_bin[2],
              q_bin_2 <- q_bin[2]<= hydro[,5] & hydro[,5]<q_bin[3],
              q_bin_3 <- q_bin[3]<= hydro[,5] & hydro[,5]<q_bin[4],
              q_bin_4 <- q_bin[4]<= hydro[,5] & hydro[,5]<q_bin[5],
              q_bin_5 <- q_bin[5]<= hydro[,5] & hydro[,5]<q_bin[6],
              q_bin_6 <- q_bin[6]<= hydro[,5] & hydro[,5]<q_bin[7],
              q_bin_7 <- hydro[,5]>q_bin[7])

colnames(q_bin_scenario3) <- c("date","q_bin_0","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_scenario3_yr <- cbind(length(which(q_bin_1))/(length(q_bin_1)-length(which(q_bin_0))),
                                       length(which(q_bin_2))/(length(q_bin_2)-length(which(q_bin_0))),
                                       length(which(q_bin_3))/(length(q_bin_3)-length(which(q_bin_0))),
                                       length(which(q_bin_4))/(length(q_bin_4)-length(which(q_bin_0))),
                                       length(which(q_bin_5))/(length(q_bin_5)-length(which(q_bin_0))),
                                       length(which(q_bin_6))/(length(q_bin_6)-length(which(q_bin_0))),
                                      length(which(q_bin_7))/(length(q_bin_7)-length(which(q_bin_0))))

colnames(q_prob_scenario3_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")
row.names(q_prob_scenario3_yr) <- c("q_prob")

q_prob_yr <- rbind(q_prob_natural_yr,q_prob_scenario1_yr,q_prob_scenario1_yr,q_prob_scenario3_yr)
row.names(q_prob_yr) <- c("natural", "current_operations", "combined_operations", "scenario3")
```

Calculates the probability of a bin flood event occuring for the natural flow scenario for discrete time states (April-May, June-July, August-September). Each flow scenario corrects the probability distribution for error by normalizing the probabilities (i.e. ensuring the distribution sums to 1).
```{r}
apr_may_bin <- q_bin_natural[months(q_bin_natural$date) %in% month.name[4:5],]
jun_jul_bin <- q_bin_natural[months(q_bin_natural$date) %in% month.name[6:7],]
aug_sep_bin <- q_bin_natural[months(q_bin_natural$date) %in% month.name[8:9],]

q_prob_natural_apr_may <- cbind(length(which(apr_may_bin$q_bin_1))/(length(apr_may_bin$q_bin_1)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_2))/(length(apr_may_bin$q_bin_2)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_3))/(length(apr_may_bin$q_bin_3)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_4))/(length(apr_may_bin$q_bin_4)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_5))/(length(apr_may_bin$q_bin_5)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_6))/(length(apr_may_bin$q_bin_6)-length(which(apr_may_bin$q_bin_0))),
                                       length(which(apr_may_bin$q_bin_7))/(length(apr_may_bin$q_bin_7)-length(which(apr_may_bin$q_bin_0))))

colnames(q_prob_natural_apr_may) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_natural_jun_jul <- cbind(length(which(jun_jul_bin$q_bin_1))/(length(jun_jul_bin$q_bin_1)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_2))/(length(jun_jul_bin$q_bin_2)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_3))/(length(jun_jul_bin$q_bin_3)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_4))/(length(jun_jul_bin$q_bin_4)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_5))/(length(jun_jul_bin$q_bin_5)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_6))/(length(jun_jul_bin$q_bin_6)-length(which(jun_jul_bin$q_bin_0))),
                                       length(which(jun_jul_bin$q_bin_7))/(length(jun_jul_bin$q_bin_7)-length(which(jun_jul_bin$q_bin_0))))

colnames(q_prob_natural_jun_jul) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_natural_aug_sep <- cbind(length(which(aug_sep_bin$q_bin_1))/(length(aug_sep_bin$q_bin_1)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_2))/(length(aug_sep_bin$q_bin_2)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_3))/(length(aug_sep_bin$q_bin_3)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_4))/(length(aug_sep_bin$q_bin_4)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_5))/(length(aug_sep_bin$q_bin_5)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_6))/(length(aug_sep_bin$q_bin_6)-length(which(aug_sep_bin$q_bin_0))),
                                       length(which(aug_sep_bin$q_bin_7))/(length(aug_sep_bin$q_bin_7)-length(which(aug_sep_bin$q_bin_0))))

colnames(q_prob_natural_aug_sep) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7")

q_prob_natural_discrete <- rbind(q_prob_natural_apr_may,q_prob_natural_jun_jul,q_prob_natural_aug_sep)
row.names(q_prob_natural_discrete) <- c("apr_may","jun_jul","aug_sep")
q_prob_natural_discrete <- q_prob_natural_discrete/rowSums(q_prob_natural_discrete)
```