---
title: "Upper Gila Watershed Preprocessing"
author:"Lauren Victoria Jaramillo, UNM (alwayslo@unm.edu)"
date: "11/29/2018"
update: "3/28/2019"
output: html_notebook
---

This R notebook is used to process the existing hydrology (Gila at Gila River USGS gage No.09430500). Conditional probabilities for inundation and recession rates are calculated in this script. Recession rates were calculated using information for site 1 only for this recreation of the historical model/process.

This first code chunck clears the environment, installs all the necessary packages, and returns the current working directory to ensure filespaths will execute properly.
```{r}
rm(list=ls())
library("xts")
library("prob")
library("TTR")
library("bigmemory")
library("zoo")
library("raster")
library("sp")
library("rgdal")
library("rasterVis")
library("ggplot2")
library("rgdal")
library("dplyr")

getwd()
```

#### Process USGS hydrology data ####
The hydrologic historical data for the Gila River is located in scenario.csv and includes the two CUFA scenarios. Hydrologic scenarios include (1) Natural, (2) Scenario 1 - 150cfs minimum, (3) Scenario 2 - no minimum. Units are cfs. This code chunk loads scenario.csv and uses it to create a dataframe called hydro.
```{r}
hydro <- read.csv("data/scenarios.csv", skip=1,header = TRUE)
data.frame(hydro)
hydro <- setNames(hydro, c("date","natural (cfs)", "scenario 1 (cfs)","scenario 2 (cfs)"))
```

This project includes five study sites. This code chunck adds the stage (both ft and cm) for each site based on the flowrate and previously developed regression equations for each site. concatenation
```{r}

head_conv_s1 <- data.frame(0.0011*hydro[2], 0.0011*hydro[3],0.0011*hydro[4])
head_conv_s1 <- setNames(head_conv_s1, c("natural stage (ft)", "scenario 1 stage (ft)","scenario 2 stage (ft)"))

head_conv_s2 <- data.frame(0.0011*hydro[2], 0.0011*hydro[3],0.0011*hydro[4])
head_conv_s2 <- setNames(head_conv_s2, c("natural stage (ft)", "scenario 1 stage (ft)","scenario 2 stage (ft)"))

head_conv_s3 <- data.frame(0.056*(hydro[2]^0.5612), 0.056*(hydro[3]^0.5612),0.056*(hydro[4]^0.5612))
head_conv_s3 <- setNames(head_conv_s3, c("natural stage (ft)", "scenario 1 stage (ft)","scenario 2 stage (ft)"))

head_conv_s4 <- data.frame(0.0014*(hydro[2]^0.99), 0.0014*(hydro[3]^0.99),0.0014*(hydro[4]^0.99))
head_conv_s4 <- setNames(head_conv_s4, c("natural stage (ft)", "scenario 1 stage (ft)","scenario 2 stage (ft)"))

head_conv_s5 <- data.frame(0.1123*(hydro[2]^0.4963), 0.1123*(hydro[3]^0.4963),0.1123*(hydro[4]^0.4963))
head_conv_s5 <- setNames(head_conv_s5, c("natural stage (ft)", "scenario 1 stage (ft)","scenario 2 stage (ft)"))


head_cm_s1 <- data.frame(head_conv_s1[1]*30.48,head_conv_s1[2]*30.48,head_conv_s1[3]*30.48)
head_cm_s1 <- setNames(head_cm_s1,c("natural stage (cm)", "scenario 1 stage (cm)","scenario 2 stage (cm)"))

head_cm_s2 <- data.frame(head_conv_s2[1]*30.48,head_conv_s2[2]*30.48,head_conv_s2[3]*30.48)
head_cm_s2 <- setNames(head_cm_s2,c("natural stage (cm)", "scenario 1 stage (cm)","scenario 2 stage (cm)"))

head_cm_s3 <- data.frame(head_conv_s3[1]*30.48,head_conv_s3[2]*30.48,head_conv_s3[3]*30.48)
head_cm_s3 <- setNames(head_cm_s3,c("natural stage (cm)", "scenario 1 stage (cm)","scenario 2 stage (cm)"))

head_cm_s4 <- data.frame(head_conv_s4[1]*30.48,head_conv_s4[2]*30.48,head_conv_s4[3]*30.48)
head_cm_s4 <- setNames(head_cm_s4,c("natural stage (cm)", "scenario 1 stage (cm)","scenario 2 stage (cm)"))

head_cm_s5 <- data.frame(head_conv_s5[1]*30.48,head_conv_s5[2]*30.48,head_conv_s5[3]*30.48)
head_cm_s5 <- setNames(head_cm_s5,c("natural stage (cm)", "scenario 1 stage (cm)","scenario 2 stage (cm)"))
```

#### Calculate recession rates ####
Calculates the 14-day recession rate (cm/day). Recession rate (forward) was calculated using a 14 day average based on site 1. The equation was mimicing that of Morrison & Stone (2014).
```{r}
# average_natural_stage_14_day <-sum(head_cm_s1[1:14,1])/14
# recession_rate_natural_14_day <- (head_cm_s1[1,1] - head_cm_s1[14,1])/14

recessionrate_14d<- data.frame()

for (i in 1:(nrow(head_cm_s1))) 
  {recessionrate_14d <- rbind(recessionrate_14d,c((head_cm_s1[i,1]-head_cm_s1[13+i,1])/14,
                                                  (head_cm_s1[i,2]-head_cm_s1[13+i,2])/14,
                                                  (head_cm_s1[i,3]-head_cm_s1[13+i,3])/14))}

recessionrate_14d <- cbind(hydro[,1],recessionrate_14d)
recessionrate_14d <- setNames(recessionrate_14d,c("date","natural stage (cm/d)","scenario 1 stage (cm/d)","scenario 2 stage (cm/d)"))
recessionrate_14d<-na.omit(recessionrate_14d)
```

Calculates the 30-day recession rate (cm/day). Recession rate (forward) was calculated using a 30 day average in reference to Cairns et al. (1994).
```{r}

# average_natural_stage_30_day <-sum(head_cm_s1[1:30,1])/30
# recession_rate_natural_30_day <- (head_cm_s1[1,1] - head_cm_s1[30,1])/30

recessionrate_30d<- data.frame()

for (i in 1:(nrow(head_cm_s1))) 
  {recessionrate_30d <- rbind(recessionrate_30d,c((head_cm_s1[i,1]-head_cm_s1[29+i,1])/30,
                                                  (head_cm_s1[i,2]-head_cm_s1[29+i,2])/30,
                                                  (head_cm_s1[i,3]-head_cm_s1[29+i,3])/30))}

recessionrate_30d <- cbind(hydro[,1],recessionrate_30d)
recessionrate_30d <- setNames(recessionrate_30d,c("date","natural stage (cm/d)", "scenario 1 stage (cm/d)","scenario 2 stage (cm/d)"))
recessionrate_30d<-na.omit(recessionrate_30d)

```

#### Process Q-model bins ####
Establishes model q-bins and calculates the probability of discharge range for any given entire year and discrete time state (April-May, June-July, August-September).Model Q-bins were selected so that inundation areas increased by less than 15% between the discharge associated with each bin (i.e. 1000 cfs, 1500 cfs, 2000 cfs, 2500 cfs, 3000 cfs, 3500 cfs, 4000 cfs). 

```{r}
q_bin <- c(1000, 1500, 2000, 2500, 3000, 3500, 4000)

```

Calculates the annual probability of a bin flood event occuring for all three flow scenarios.
```{r}
q_bin_natural <-cbind(hydro[1],q_bin_1 <- hydro[2]<= q_bin[1],
              q_bin_2 <- q_bin[1]< hydro[2] & hydro[2]<=q_bin[2],
              q_bin_3 <- q_bin[2]< hydro[2] & hydro[2]<=q_bin[3],
              q_bin_4 <- q_bin[3]< hydro[2] & hydro[2]<=q_bin[4],
              q_bin_5 <- q_bin[4]< hydro[2] & hydro[2]<=q_bin[5],
              q_bin_6 <- q_bin[5]< hydro[2] & hydro[2]<=q_bin[6],
              q_bin_7 <- q_bin[6]< hydro[2] & hydro[2]<=q_bin[7],
              q_bin_8 <- hydro[2]>q_bin[7])

colnames(q_bin_natural) <- c("date","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_natural_yr <- cbind(length(which(q_bin_1))/length(q_bin_1),
                                       length(which(q_bin_2))/length(q_bin_2),
                                       length(which(q_bin_3))/length(q_bin_3),
                                       length(which(q_bin_4))/length(q_bin_4),
                                       length(which(q_bin_5))/length(q_bin_5),
                                       length(which(q_bin_6))/length(q_bin_6),
                                      length(which(q_bin_7))/length(q_bin_7),
                                       length(which(q_bin_8))/length(q_bin_8))

colnames(q_prob_natural_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_bin_scenario1<-cbind(hydro[1],q_bin_1 <- hydro[3]<= q_bin[1],
              q_bin_2 <- q_bin[1]< hydro[3] & hydro[3]<=q_bin[2],
              q_bin_3 <- q_bin[2]< hydro[3] & hydro[3]<=q_bin[3],
              q_bin_4 <- q_bin[3]< hydro[3] & hydro[3]<=q_bin[4],
              q_bin_5 <- q_bin[4]< hydro[3] & hydro[3]<=q_bin[5],
              q_bin_6 <- q_bin[5]< hydro[3] & hydro[3]<=q_bin[6],
              q_bin_7 <- q_bin[6]< hydro[3] & hydro[3]<=q_bin[7],
              q_bin_8 <- hydro[3]>q_bin[7])

colnames(q_bin_scenario1) <- c("date","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_scenario1_yr <- cbind(length(which(q_bin_1))/length(q_bin_1),
                                       length(which(q_bin_2))/length(q_bin_2),
                                       length(which(q_bin_3))/length(q_bin_3),
                                       length(which(q_bin_4))/length(q_bin_4),
                                       length(which(q_bin_5))/length(q_bin_5),
                                       length(which(q_bin_6))/length(q_bin_6),
                                       length(which(q_bin_7))/length(q_bin_7),
                                       length(which(q_bin_8))/length(q_bin_8))

colnames(q_prob_scenario1_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_bin_scenario2<-cbind(hydro[1],q_bin_1 <- hydro[4]<= q_bin[1],
              q_bin_2 <- q_bin[1]< hydro[4] & hydro[4]<=q_bin[2],
              q_bin_3 <- q_bin[2]< hydro[4] & hydro[4]<=q_bin[3],
              q_bin_4 <- q_bin[3]< hydro[4] & hydro[4]<=q_bin[4],
              q_bin_5 <- q_bin[4]< hydro[4] & hydro[4]<=q_bin[5],
              q_bin_6 <- q_bin[5]< hydro[4] & hydro[4]<=q_bin[6],
              q_bin_7 <- q_bin[6]< hydro[4] & hydro[4]<=q_bin[7],
              q_bin_8 <- hydro[4]>q_bin[7])

colnames(q_bin_scenario2) <- c("date","q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_scenario2_yr <- cbind(length(which(q_bin_1))/length(q_bin_1),
                                       length(which(q_bin_2))/length(q_bin_2),
                                       length(which(q_bin_3))/length(q_bin_3),
                                       length(which(q_bin_4))/length(q_bin_4),
                                       length(which(q_bin_5))/length(q_bin_5),
                                       length(which(q_bin_6))/length(q_bin_6),
                                       length(which(q_bin_7))/length(q_bin_7),
                                       length(which(q_bin_8))/length(q_bin_8))

colnames(q_prob_scenario2_yr) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_yr <- rbind(q_prob_natural_yr,q_prob_scenario1_yr,q_prob_scenario2_yr)
row.names(q_prob_yr) <- c("natural","scenario 1","scenario 2")
```

Calculates the probability of a bin flood event occuring for the natural flow scenario for discrete time states (April-May, June-July, August-September). Each flow scenario corrects the probability distribution for error by normalizing the probabilities (i.e. ensuring the distribution sums to 1).
```{r}

q_bin_natural$date<-as.Date(q_bin_natural$date, format="%m/%d/%Y")

apr_may_bin <- q_bin_natural[months(q_bin_natural$date) %in% month.name[4:5],]
jun_jul_bin <- q_bin_natural[months(q_bin_natural$date) %in% month.name[6:7],]
aug_sep_bin <- q_bin_natural[months(q_bin_natural$date) %in% month.name[8:9],]

q_prob_natural_apr_may <- cbind(length(which(apr_may_bin$q_bin_1))/length(apr_may_bin$q_bin_1),
                                       length(which(apr_may_bin$q_bin_2))/length(apr_may_bin$q_bin_2),
                                       length(which(apr_may_bin$q_bin_3))/length(apr_may_bin$q_bin_3),
                                       length(which(apr_may_bin$q_bin_4))/length(apr_may_bin$q_bin_4),
                                       length(which(apr_may_bin$q_bin_5))/length(apr_may_bin$q_bin_5),
                                       length(which(apr_may_bin$q_bin_6))/length(apr_may_bin$q_bin_6),
                                       length(which(apr_may_bin$q_bin_7))/length(apr_may_bin$q_bin_7),
                                       length(which(apr_may_bin$q_bin_8))/length(apr_may_bin$q_bin_8))

colnames(q_prob_natural_apr_may) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_natural_jun_jul <- cbind(length(which(jun_jul_bin$q_bin_1))/length(jun_jul_bin$q_bin_1),
                                       length(which(jun_jul_bin$q_bin_2))/length(jun_jul_bin$q_bin_2),
                                       length(which(jun_jul_bin$q_bin_3))/length(jun_jul_bin$q_bin_3),
                                       length(which(jun_jul_bin$q_bin_4))/length(jun_jul_bin$q_bin_4),
                                       length(which(jun_jul_bin$q_bin_5))/length(jun_jul_bin$q_bin_5),
                                       length(which(jun_jul_bin$q_bin_6))/length(jun_jul_bin$q_bin_6),
                                       length(which(jun_jul_bin$q_bin_7))/length(jun_jul_bin$q_bin_7),
                                       length(which(jun_jul_bin$q_bin_8))/length(jun_jul_bin$q_bin_8))

colnames(q_prob_natural_jun_jul) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_natural_aug_sep <- cbind(length(which(aug_sep_bin$q_bin_1))/length(aug_sep_bin$q_bin_1),
                                       length(which(aug_sep_bin$q_bin_2))/length(aug_sep_bin$q_bin_2),
                                       length(which(aug_sep_bin$q_bin_3))/length(aug_sep_bin$q_bin_3),
                                       length(which(aug_sep_bin$q_bin_4))/length(aug_sep_bin$q_bin_4),
                                       length(which(aug_sep_bin$q_bin_5))/length(aug_sep_bin$q_bin_5),
                                       length(which(aug_sep_bin$q_bin_6))/length(aug_sep_bin$q_bin_6),
                                       length(which(aug_sep_bin$q_bin_7))/length(aug_sep_bin$q_bin_7),
                                       length(which(aug_sep_bin$q_bin_8))/length(aug_sep_bin$q_bin_8))

colnames(q_prob_natural_aug_sep) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_natural_discrete <- rbind(q_prob_natural_apr_may,q_prob_natural_jun_jul,q_prob_natural_aug_sep)
row.names(q_prob_natural_discrete) <- c("apr_may","jun_jul","aug_sep")
q_prob_natural_discrete <- q_prob_natural_discrete/rowSums(q_prob_natural_discrete)
```

Calculates the probability of a bin flood event occuring for the scenario 1 flow scenario for discrete time states (April-May, June-July, August-September).
```{r}                                
q_bin_scenario1$date<-as.Date(q_bin_scenario1$date, format="%m/%d/%Y")

apr_may_bin <- q_bin_scenario1[months(q_bin_scenario1$date) %in% month.name[4:5],]
jun_jul_bin <- q_bin_scenario1[months(q_bin_scenario1$date) %in% month.name[6:7],]
aug_sep_bin <- q_bin_scenario1[months(q_bin_scenario1$date) %in% month.name[8:9],]

q_prob_scenario1_apr_may <- cbind(length(which(apr_may_bin$q_bin_1))/length(apr_may_bin$q_bin_1),
                                       length(which(apr_may_bin$q_bin_2))/length(apr_may_bin$q_bin_2),
                                       length(which(apr_may_bin$q_bin_3))/length(apr_may_bin$q_bin_3),
                                       length(which(apr_may_bin$q_bin_4))/length(apr_may_bin$q_bin_4),
                                       length(which(apr_may_bin$q_bin_5))/length(apr_may_bin$q_bin_5),
                                       length(which(apr_may_bin$q_bin_6))/length(apr_may_bin$q_bin_6),
                                       length(which(apr_may_bin$q_bin_7))/length(apr_may_bin$q_bin_7),
                                       length(which(apr_may_bin$q_bin_8))/length(apr_may_bin$q_bin_8))

colnames(q_prob_scenario1_apr_may) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_scenario1_jun_jul <- cbind(length(which(jun_jul_bin$q_bin_1))/length(jun_jul_bin$q_bin_1),
                                       length(which(jun_jul_bin$q_bin_2))/length(jun_jul_bin$q_bin_2),
                                       length(which(jun_jul_bin$q_bin_3))/length(jun_jul_bin$q_bin_3),
                                       length(which(jun_jul_bin$q_bin_4))/length(jun_jul_bin$q_bin_4),
                                       length(which(jun_jul_bin$q_bin_5))/length(jun_jul_bin$q_bin_5),
                                       length(which(jun_jul_bin$q_bin_6))/length(jun_jul_bin$q_bin_6),
                                       length(which(jun_jul_bin$q_bin_7))/length(jun_jul_bin$q_bin_7),
                                       length(which(jun_jul_bin$q_bin_8))/length(jun_jul_bin$q_bin_8))

colnames(q_prob_scenario1_jun_jul) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_scenario1_aug_sep <- cbind(length(which(aug_sep_bin$q_bin_1))/length(aug_sep_bin$q_bin_1),
                                       length(which(aug_sep_bin$q_bin_2))/length(aug_sep_bin$q_bin_2),
                                       length(which(aug_sep_bin$q_bin_3))/length(aug_sep_bin$q_bin_3),
                                       length(which(aug_sep_bin$q_bin_4))/length(aug_sep_bin$q_bin_4),
                                       length(which(aug_sep_bin$q_bin_5))/length(aug_sep_bin$q_bin_5),
                                       length(which(aug_sep_bin$q_bin_6))/length(aug_sep_bin$q_bin_6),
                                       length(which(aug_sep_bin$q_bin_7))/length(aug_sep_bin$q_bin_7),
                                       length(which(aug_sep_bin$q_bin_8))/length(aug_sep_bin$q_bin_8))

colnames(q_prob_scenario1_aug_sep) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_scenario1_discrete <- rbind(q_prob_scenario1_apr_may,q_prob_scenario1_jun_jul,q_prob_scenario1_aug_sep)
row.names(q_prob_scenario1_discrete) <- c("apr_may","jun_jul","aug_sep")
q_prob_scenario1_discrete <- q_prob_scenario1_discrete/rowSums(q_prob_scenario1_discrete)
```

Calculates the probability of a bin flood event occuring for the scenario 2 flow scenario for discrete time states (April-May, June-July, August-September).
```{r} 
q_bin_scenario2$date<-as.Date(q_bin_scenario2$date, format="%m/%d/%Y")

apr_may_bin <- q_bin_scenario2[months(q_bin_scenario2$date) %in% month.name[4:5],]
jun_jul_bin <- q_bin_scenario2[months(q_bin_scenario2$date) %in% month.name[6:7],]
aug_sep_bin <- q_bin_scenario2[months(q_bin_scenario2$date) %in% month.name[8:9],]

q_prob_scenario2_apr_may <- cbind(length(which(apr_may_bin$q_bin_1))/length(apr_may_bin$q_bin_1),
                                       length(which(apr_may_bin$q_bin_2))/length(apr_may_bin$q_bin_2),
                                       length(which(apr_may_bin$q_bin_3))/length(apr_may_bin$q_bin_3),
                                       length(which(apr_may_bin$q_bin_4))/length(apr_may_bin$q_bin_4),
                                       length(which(apr_may_bin$q_bin_5))/length(apr_may_bin$q_bin_5),
                                       length(which(apr_may_bin$q_bin_6))/length(apr_may_bin$q_bin_6),
                                       length(which(apr_may_bin$q_bin_7))/length(apr_may_bin$q_bin_7),
                                       length(which(apr_may_bin$q_bin_8))/length(apr_may_bin$q_bin_8))

colnames(q_prob_scenario2_apr_may) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_scenario2_jun_jul <- cbind(length(which(jun_jul_bin$q_bin_1))/length(jun_jul_bin$q_bin_1),
                                       length(which(jun_jul_bin$q_bin_2))/length(jun_jul_bin$q_bin_2),
                                       length(which(jun_jul_bin$q_bin_3))/length(jun_jul_bin$q_bin_3),
                                       length(which(jun_jul_bin$q_bin_4))/length(jun_jul_bin$q_bin_4),
                                       length(which(jun_jul_bin$q_bin_5))/length(jun_jul_bin$q_bin_5),
                                       length(which(jun_jul_bin$q_bin_6))/length(jun_jul_bin$q_bin_6),
                                       length(which(jun_jul_bin$q_bin_7))/length(jun_jul_bin$q_bin_7),
                                       length(which(jun_jul_bin$q_bin_8))/length(jun_jul_bin$q_bin_8))

colnames(q_prob_scenario2_jun_jul) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")
q_prob_scenario2_jun_jul <- q_prob_scenario2_jun_jul/rowSums(q_prob_scenario2_jun_jul)

q_prob_scenario2_aug_sep <- cbind(length(which(aug_sep_bin$q_bin_1))/length(aug_sep_bin$q_bin_1),
                                       length(which(aug_sep_bin$q_bin_2))/length(aug_sep_bin$q_bin_2),
                                       length(which(aug_sep_bin$q_bin_3))/length(aug_sep_bin$q_bin_3),
                                       length(which(aug_sep_bin$q_bin_4))/length(aug_sep_bin$q_bin_4),
                                       length(which(aug_sep_bin$q_bin_5))/length(aug_sep_bin$q_bin_5),
                                       length(which(aug_sep_bin$q_bin_6))/length(aug_sep_bin$q_bin_6),
                                       length(which(aug_sep_bin$q_bin_7))/length(aug_sep_bin$q_bin_7),
                                       length(which(aug_sep_bin$q_bin_8))/length(aug_sep_bin$q_bin_8))

colnames(q_prob_scenario2_aug_sep) <- c("q_bin_1", "q_bin_2","q_bin_3","q_bin_4","q_bin_5","q_bin_6","q_bin_7","q_bin_8")

q_prob_scenario2_discrete <- rbind(q_prob_scenario2_apr_may,q_prob_scenario2_jun_jul,q_prob_scenario2_aug_sep)
row.names(q_prob_scenario2_discrete) <- c("apr_may","jun_jul","aug_sep")
q_prob_scenario2_discrete <- q_prob_scenario2_discrete/rowSums(q_prob_scenario2_discrete)
```

#### Process recession rate bins ####
Establishes model recession rate bins and calculates the probability of recession rate ranges for 14-day and 30-day recession rates for any given entire year and discrete time state (April-May, June-July, August-September).

Recession rate bins were selected so that .....???? (i.e. 0 cm/day, 1 cm/day, 3 cm/day, 6 cm/day).
```{r}
recessionrate_bin <- c(0,1,3,6)
```

## 14-day recession rate bin and probabilities##
Bins the 14-day recession rates for the natural flow scenario and calculates the probability of the recession rate range for any given year.
```{r}
a <- recessionrate_14d[2]
b <- recessionrate_14d[1]

rr_14d_bin_natural <-cbind( recessionrate_14d[1], recessionrate_bin_1 <- a <= recessionrate_bin[1],
              recessionrate_bin_2 <- recessionrate_bin[1]< a & a <=recessionrate_bin[2],
              recessionrate_bin_3 <- recessionrate_bin[2]< a & a <=recessionrate_bin[3],
              recessionrate_bin_4 <- recessionrate_bin[3]< a & a <=recessionrate_bin[4],
              recessionrate_bin_5 <- a > recessionrate_bin[4])

colnames(rr_14d_bin_natural) <- c("date",
                                  "recessionrate_bin_1",
                                  "recessionrate_bin_2",
                                  "recessionrate_bin_3",
                                  "recessionrate_bin_4",
                                  "recessionrate_bin_5")

rr_14d_bin_natural$date<-as.Date(rr_14d_bin_natural$date, format="%m/%d/%Y")

rr_14d_prob_natural_yr <-cbind(length(which(recessionrate_bin_1))/length(recessionrate_bin_1),
                                       length(which(recessionrate_bin_2))/length(recessionrate_bin_2),
                                       length(which(recessionrate_bin_3))/length(recessionrate_bin_3),
                                       length(which(recessionrate_bin_4))/length(recessionrate_bin_4),
                                       length(which(recessionrate_bin_5))/length(recessionrate_bin_5))

colnames(rr_14d_prob_natural_yr) <- c("recessionrate_bin_1",
                                        "recessionrate_bin_2",
                                        "recessionrate_bin_3",
                                        "recessionrate_bin_4",
                                        "recessionrate_bin_5")

```

Bins the 14-day recession rates for the scenario 1 flow scenario and calculates the probability of the recession rate range for any given year.
```{r}
a <- recessionrate_14d[3]
b <- recessionrate_14d[1]

rr_14d_bin_scenario1 <-cbind( recessionrate_14d[1], recessionrate_bin_1 <- a <= recessionrate_bin[1],
              recessionrate_bin_2 <- recessionrate_bin[1]< a & a <=recessionrate_bin[2],
              recessionrate_bin_3 <- recessionrate_bin[2]< a & a <=recessionrate_bin[3],
              recessionrate_bin_4 <- recessionrate_bin[3]< a & a <=recessionrate_bin[4],
              recessionrate_bin_5 <- a > recessionrate_bin[4])

colnames(rr_14d_bin_scenario1) <- c("date",
                                  "recessionrate_bin_1",
                                  "recessionrate_bin_2",
                                  "recessionrate_bin_3",
                                  "recessionrate_bin_4",
                                  "recessionrate_bin_5")

rr_14d_bin_scenario1$date<-as.Date(rr_14d_bin_scenario1$date, format="%m/%d/%Y")

rr_14d_prob_scenario1_yr <-cbind(length(which(recessionrate_bin_1))/length(recessionrate_bin_1),
                                       length(which(recessionrate_bin_2))/length(recessionrate_bin_2),
                                       length(which(recessionrate_bin_3))/length(recessionrate_bin_3),
                                       length(which(recessionrate_bin_4))/length(recessionrate_bin_4),
                                       length(which(recessionrate_bin_5))/length(recessionrate_bin_5))

colnames(rr_14d_prob_scenario1_yr) <- c("recessionrate_bin_1",
                                        "recessionrate_bin_2",
                                        "recessionrate_bin_3",
                                        "recessionrate_bin_4",
                                        "recessionrate_bin_5")
```

Bins the 14-day recession rates for the scenario 2 flow scenario and calculates the probability of the recession rate range for any given year.
```{r}
a <- recessionrate_14d[4]
b <- recessionrate_14d[1]

rr_14d_bin_scenario2 <-cbind( recessionrate_14d[1], recessionrate_bin_1 <- a <= recessionrate_bin[1],
              recessionrate_bin_2 <- recessionrate_bin[1]< a & a <=recessionrate_bin[2],
              recessionrate_bin_3 <- recessionrate_bin[2]< a & a <=recessionrate_bin[3],
              recessionrate_bin_4 <- recessionrate_bin[3]< a & a <=recessionrate_bin[4],
              recessionrate_bin_5 <- a > recessionrate_bin[4])

colnames(rr_14d_bin_scenario2) <- c("date",
                                  "recessionrate_bin_1",
                                  "recessionrate_bin_2",
                                  "recessionrate_bin_3",
                                  "recessionrate_bin_4",
                                  "recessionrate_bin_5")

rr_14d_bin_scenario2$date<-as.Date(rr_14d_bin_scenario2$date, format="%m/%d/%Y")

rr_14d_prob_scenario2_yr <-cbind(length(which(recessionrate_bin_1))/length(recessionrate_bin_1),
                                       length(which(recessionrate_bin_2))/length(recessionrate_bin_2),
                                       length(which(recessionrate_bin_3))/length(recessionrate_bin_3),
                                       length(which(recessionrate_bin_4))/length(recessionrate_bin_4),
                                       length(which(recessionrate_bin_5))/length(recessionrate_bin_5))

colnames(rr_14d_prob_scenario2_yr) <- c("recessionrate_bin_1",
                                        "recessionrate_bin_2",
                                        "recessionrate_bin_3",
                                        "recessionrate_bin_4",
                                        "recessionrate_bin_5")
```

Combines annual 14-day recession rate probabilities for each flow scenario.
```{r}
rr_14d_prob_yr <- rbind(rr_14d_prob_natural_yr,rr_14d_prob_scenario1_yr,rr_14d_prob_scenario2_yr)
row.names(rr_14d_prob_yr) <- c("natural","scenario 1","scenario 2")
```

Calculates the probability of 14-day recession rate ranges for the natural flow scenario and discrete time state (April-May, June-July, August-September).
```{r}

apr_may_bin <- rr_14d_bin_natural[months(rr_14d_bin_natural$date) %in% month.name[4:5],]
jun_jul_bin <- rr_14d_bin_natural[months(rr_14d_bin_natural$date) %in% month.name[6:7],]
aug_sep_bin <- rr_14d_bin_natural[months(rr_14d_bin_natural$date) %in% month.name[8:9],]

rr_14d_prob_natural_apr_may <- cbind(length(which(apr_may_bin$recessionrate_bin_1))/length(apr_may_bin$recessionrate_bin_1),
                                       length(which(apr_may_bin$recessionrate_bin_2))/length(apr_may_bin$recessionrate_bin_2),
                                       length(which(apr_may_bin$recessionrate_bin_3))/length(apr_may_bin$recessionrate_bin_3),
                                       length(which(apr_may_bin$recessionrate_bin_4))/length(apr_may_bin$recessionrate_bin_4),
                                       length(which(apr_may_bin$recessionrate_bin_5))/length(apr_may_bin$recessionrate_bin_5))

colnames(rr_14d_prob_natural_apr_may) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_natural_jun_jul <- cbind(length(which(jun_jul_bin$recessionrate_bin_1))/length(jun_jul_bin$recessionrate_bin_1),
                                       length(which(jun_jul_bin$recessionrate_bin_2))/length(jun_jul_bin$recessionrate_bin_2),
                                       length(which(jun_jul_bin$recessionrate_bin_3))/length(jun_jul_bin$recessionrate_bin_3),
                                       length(which(jun_jul_bin$recessionrate_bin_4))/length(jun_jul_bin$recessionrate_bin_4),
                                       length(which(jun_jul_bin$recessionrate_bin_5))/length(jun_jul_bin$recessionrate_bin_5))

colnames(rr_14d_prob_natural_jun_jul) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_natural_aug_sep <- cbind(length(which(aug_sep_bin$recessionrate_bin_1))/length(aug_sep_bin$recessionrate_bin_1),
                                       length(which(aug_sep_bin$recessionrate_bin_2))/length(aug_sep_bin$recessionrate_bin_2),
                                       length(which(aug_sep_bin$recessionrate_bin_3))/length(aug_sep_bin$recessionrate_bin_3),
                                       length(which(aug_sep_bin$recessionrate_bin_4))/length(aug_sep_bin$recessionrate_bin_4),
                                       length(which(aug_sep_bin$recessionrate_bin_5))/length(aug_sep_bin$recessionrate_bin_5))

colnames(rr_14d_prob_natural_aug_sep) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_natural_discrete <- rbind(rr_14d_prob_natural_apr_may,rr_14d_prob_natural_jun_jul,rr_14d_prob_natural_aug_sep)
row.names(rr_14d_prob_natural_discrete) <- c("apr_may","jun_jul","aug_sep")
rr_14d_prob_natural_discrete <- rr_14d_prob_natural_discrete/rowSums(rr_14d_prob_natural_discrete)
```

Calculates the probability of 14-day recession rate ranges for the scenario 1 flow scenario and discrete time state (April-May, June-July, August-September).
```{r}

apr_may_bin <- rr_14d_bin_scenario1[months(rr_14d_bin_scenario1$date) %in% month.name[4:5],]
jun_jul_bin <- rr_14d_bin_scenario1[months(rr_14d_bin_scenario1$date) %in% month.name[6:7],]
aug_sep_bin <- rr_14d_bin_scenario1[months(rr_14d_bin_scenario1$date) %in% month.name[8:9],]

rr_14d_prob_scenario1_apr_may <- cbind(length(which(apr_may_bin$recessionrate_bin_1))/length(apr_may_bin$recessionrate_bin_1),
                                       length(which(apr_may_bin$recessionrate_bin_2))/length(apr_may_bin$recessionrate_bin_2),
                                       length(which(apr_may_bin$recessionrate_bin_3))/length(apr_may_bin$recessionrate_bin_3),
                                       length(which(apr_may_bin$recessionrate_bin_4))/length(apr_may_bin$recessionrate_bin_4),
                                       length(which(apr_may_bin$recessionrate_bin_5))/length(apr_may_bin$recessionrate_bin_5))

colnames(rr_14d_prob_scenario1_apr_may) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_scenario1_jun_jul <- cbind(length(which(jun_jul_bin$recessionrate_bin_1))/length(jun_jul_bin$recessionrate_bin_1),
                                       length(which(jun_jul_bin$recessionrate_bin_2))/length(jun_jul_bin$recessionrate_bin_2),
                                       length(which(jun_jul_bin$recessionrate_bin_3))/length(jun_jul_bin$recessionrate_bin_3),
                                       length(which(jun_jul_bin$recessionrate_bin_4))/length(jun_jul_bin$recessionrate_bin_4),
                                       length(which(jun_jul_bin$recessionrate_bin_5))/length(jun_jul_bin$recessionrate_bin_5))

colnames(rr_14d_prob_scenario1_jun_jul) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_scenario1_aug_sep <- cbind(length(which(aug_sep_bin$recessionrate_bin_1))/length(aug_sep_bin$recessionrate_bin_1),
                                       length(which(aug_sep_bin$recessionrate_bin_2))/length(aug_sep_bin$recessionrate_bin_2),
                                       length(which(aug_sep_bin$recessionrate_bin_3))/length(aug_sep_bin$recessionrate_bin_3),
                                       length(which(aug_sep_bin$recessionrate_bin_4))/length(aug_sep_bin$recessionrate_bin_4),
                                       length(which(aug_sep_bin$recessionrate_bin_5))/length(aug_sep_bin$recessionrate_bin_5))

colnames(rr_14d_prob_scenario1_aug_sep) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_scenario1_discrete <- rbind(rr_14d_prob_scenario1_apr_may,rr_14d_prob_scenario1_jun_jul,rr_14d_prob_scenario1_aug_sep)
row.names(rr_14d_prob_scenario1_discrete) <- c("apr_may","jun_jul","aug_sep")
rr_14d_prob_scenario1_discrete <- rr_14d_prob_scenario1_discrete/rowSums(rr_14d_prob_scenario1_discrete)
```

Calculates the probability of 14-day recession rate ranges for the scenario 2 flow scenario and discrete time state (April-May, June-July, August-September).
```{r}

apr_may_bin <- rr_14d_bin_scenario2[months(rr_14d_bin_scenario2$date) %in% month.name[4:5],]
jun_jul_bin <- rr_14d_bin_scenario2[months(rr_14d_bin_scenario2$date) %in% month.name[6:7],]
aug_sep_bin <- rr_14d_bin_scenario2[months(rr_14d_bin_scenario2$date) %in% month.name[8:9],]

rr_14d_prob_scenario2_apr_may <- cbind(length(which(apr_may_bin$recessionrate_bin_1))/length(apr_may_bin$recessionrate_bin_1),
                                       length(which(apr_may_bin$recessionrate_bin_2))/length(apr_may_bin$recessionrate_bin_2),
                                       length(which(apr_may_bin$recessionrate_bin_3))/length(apr_may_bin$recessionrate_bin_3),
                                       length(which(apr_may_bin$recessionrate_bin_4))/length(apr_may_bin$recessionrate_bin_4),
                                       length(which(apr_may_bin$recessionrate_bin_5))/length(apr_may_bin$recessionrate_bin_5))

colnames(rr_14d_prob_scenario2_apr_may) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_scenario2_jun_jul <- cbind(length(which(jun_jul_bin$recessionrate_bin_1))/length(jun_jul_bin$recessionrate_bin_1),
                                       length(which(jun_jul_bin$recessionrate_bin_2))/length(jun_jul_bin$recessionrate_bin_2),
                                       length(which(jun_jul_bin$recessionrate_bin_3))/length(jun_jul_bin$recessionrate_bin_3),
                                       length(which(jun_jul_bin$recessionrate_bin_4))/length(jun_jul_bin$recessionrate_bin_4),
                                       length(which(jun_jul_bin$recessionrate_bin_5))/length(jun_jul_bin$recessionrate_bin_5))

colnames(rr_14d_prob_scenario2_jun_jul) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_scenario2_aug_sep <- cbind(length(which(aug_sep_bin$recessionrate_bin_1))/length(aug_sep_bin$recessionrate_bin_1),
                                       length(which(aug_sep_bin$recessionrate_bin_2))/length(aug_sep_bin$recessionrate_bin_2),
                                       length(which(aug_sep_bin$recessionrate_bin_3))/length(aug_sep_bin$recessionrate_bin_3),
                                       length(which(aug_sep_bin$recessionrate_bin_4))/length(aug_sep_bin$recessionrate_bin_4),
                                       length(which(aug_sep_bin$recessionrate_bin_5))/length(aug_sep_bin$recessionrate_bin_5))

colnames(rr_14d_prob_scenario2_aug_sep) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_14d_prob_scenario2_discrete <- rbind(rr_14d_prob_scenario2_apr_may,rr_14d_prob_scenario2_jun_jul,rr_14d_prob_scenario2_aug_sep)
row.names(rr_14d_prob_scenario2_discrete) <- c("apr_may","jun_jul","aug_sep")
rr_14d_prob_scenario2_discrete <- rr_14d_prob_scenario2_discrete/rowSums(rr_14d_prob_scenario2_discrete)
```

## 30-day recession rate bin and probabilities##
Bins the 30-day recession rates for the natural flow scenario and calculates the probability of the recession rate range for any given year.
```{r}
a <- recessionrate_30d[2]
b <- recessionrate_30d[1]

rr_30d_bin_natural <-cbind( recessionrate_30d[1], recessionrate_bin_1 <- a <= recessionrate_bin[1],
              recessionrate_bin_2 <- recessionrate_bin[1]< a & a <=recessionrate_bin[2],
              recessionrate_bin_3 <- recessionrate_bin[2]< a & a <=recessionrate_bin[3],
              recessionrate_bin_4 <- recessionrate_bin[3]< a & a <=recessionrate_bin[4],
              recessionrate_bin_5 <- a > recessionrate_bin[4])

colnames(rr_30d_bin_natural) <- c("date",
                                  "recessionrate_bin_1",
                                  "recessionrate_bin_2",
                                  "recessionrate_bin_3",
                                  "recessionrate_bin_4",
                                  "recessionrate_bin_5")

rr_30d_bin_natural$date<-as.Date(rr_30d_bin_natural$date, format="%m/%d/%Y")

rr_30d_prob_natural_yr <-cbind(length(which(recessionrate_bin_1))/length(recessionrate_bin_1),
                                       length(which(recessionrate_bin_2))/length(recessionrate_bin_2),
                                       length(which(recessionrate_bin_3))/length(recessionrate_bin_3),
                                       length(which(recessionrate_bin_4))/length(recessionrate_bin_4),
                                       length(which(recessionrate_bin_5))/length(recessionrate_bin_5))

colnames(rr_30d_prob_natural_yr) <- c("recessionrate_bin_1",
                                        "recessionrate_bin_2",
                                        "recessionrate_bin_3",
                                        "recessionrate_bin_4",
                                        "recessionrate_bin_5")

```

Bins the 30-day recession rates for the scenario 1 flow scenario and calculates the probability of the recession rate range for any given year.
```{r}
a <- recessionrate_30d[3]
b <- recessionrate_30d[1]

rr_30d_bin_scenario1 <-cbind( recessionrate_30d[1], recessionrate_bin_1 <- a <= recessionrate_bin[1],
              recessionrate_bin_2 <- recessionrate_bin[1]< a & a <=recessionrate_bin[2],
              recessionrate_bin_3 <- recessionrate_bin[2]< a & a <=recessionrate_bin[3],
              recessionrate_bin_4 <- recessionrate_bin[3]< a & a <=recessionrate_bin[4],
              recessionrate_bin_5 <- a > recessionrate_bin[4])

colnames(rr_30d_bin_scenario1) <- c("date",
                                  "recessionrate_bin_1",
                                  "recessionrate_bin_2",
                                  "recessionrate_bin_3",
                                  "recessionrate_bin_4",
                                  "recessionrate_bin_5")

rr_30d_bin_scenario1$date<-as.Date(rr_30d_bin_scenario1$date, format="%m/%d/%Y")

rr_30d_prob_scenario1_yr <-cbind(length(which(recessionrate_bin_1))/length(recessionrate_bin_1),
                                       length(which(recessionrate_bin_2))/length(recessionrate_bin_2),
                                       length(which(recessionrate_bin_3))/length(recessionrate_bin_3),
                                       length(which(recessionrate_bin_4))/length(recessionrate_bin_4),
                                       length(which(recessionrate_bin_5))/length(recessionrate_bin_5))

colnames(rr_30d_prob_scenario1_yr) <- c("recessionrate_bin_1",
                                        "recessionrate_bin_2",
                                        "recessionrate_bin_3",
                                        "recessionrate_bin_4",
                                        "recessionrate_bin_5")
```

Bins the 30-day recession rates for the scenario 2 flow scenario and calculates the probability of the recession rate range for any given year.
```{r}
a <- recessionrate_30d[4]
b <- recessionrate_30d[1]

rr_30d_bin_scenario2 <-cbind( recessionrate_30d[1], recessionrate_bin_1 <- a <= recessionrate_bin[1],
              recessionrate_bin_2 <- recessionrate_bin[1]< a & a <=recessionrate_bin[2],
              recessionrate_bin_3 <- recessionrate_bin[2]< a & a <=recessionrate_bin[3],
              recessionrate_bin_4 <- recessionrate_bin[3]< a & a <=recessionrate_bin[4],
              recessionrate_bin_5 <- a > recessionrate_bin[4])

colnames(rr_30d_bin_scenario2) <- c("date",
                                  "recessionrate_bin_1",
                                  "recessionrate_bin_2",
                                  "recessionrate_bin_3",
                                  "recessionrate_bin_4",
                                  "recessionrate_bin_5")

rr_30d_bin_scenario2$date<-as.Date(rr_30d_bin_scenario2$date, format="%m/%d/%Y")

rr_30d_prob_scenario2_yr <-cbind(length(which(recessionrate_bin_1))/length(recessionrate_bin_1),
                                       length(which(recessionrate_bin_2))/length(recessionrate_bin_2),
                                       length(which(recessionrate_bin_3))/length(recessionrate_bin_3),
                                       length(which(recessionrate_bin_4))/length(recessionrate_bin_4),
                                       length(which(recessionrate_bin_5))/length(recessionrate_bin_5))

colnames(rr_30d_prob_scenario2_yr) <- c("recessionrate_bin_1",
                                        "recessionrate_bin_2",
                                        "recessionrate_bin_3",
                                        "recessionrate_bin_4",
                                        "recessionrate_bin_5")
```

Combines annual 30-day recession rate probabilities for each flow scenario.
```{r}
rr_30d_prob_yr <- rbind(rr_30d_prob_natural_yr,rr_30d_prob_scenario1_yr,rr_30d_prob_scenario2_yr)
row.names(rr_30d_prob_yr) <- c("natural","scenario 1","scenario 2")
```

Calculates the probability of 30-day recession rate ranges for the natural flow scenario and discrete time state (April-May, June-July, August-September).
```{r}

apr_may_bin <- rr_30d_bin_natural[months(rr_30d_bin_natural$date) %in% month.name[4:5],]
jun_jul_bin <- rr_30d_bin_natural[months(rr_30d_bin_natural$date) %in% month.name[6:7],]
aug_sep_bin <- rr_30d_bin_natural[months(rr_30d_bin_natural$date) %in% month.name[8:9],]

rr_30d_prob_natural_apr_may <- cbind(length(which(apr_may_bin$recessionrate_bin_1))/length(apr_may_bin$recessionrate_bin_1),
                                       length(which(apr_may_bin$recessionrate_bin_2))/length(apr_may_bin$recessionrate_bin_2),
                                       length(which(apr_may_bin$recessionrate_bin_3))/length(apr_may_bin$recessionrate_bin_3),
                                       length(which(apr_may_bin$recessionrate_bin_4))/length(apr_may_bin$recessionrate_bin_4),
                                       length(which(apr_may_bin$recessionrate_bin_5))/length(apr_may_bin$recessionrate_bin_5))

colnames(rr_30d_prob_natural_apr_may) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_natural_jun_jul <- cbind(length(which(jun_jul_bin$recessionrate_bin_1))/length(jun_jul_bin$recessionrate_bin_1),
                                       length(which(jun_jul_bin$recessionrate_bin_2))/length(jun_jul_bin$recessionrate_bin_2),
                                       length(which(jun_jul_bin$recessionrate_bin_3))/length(jun_jul_bin$recessionrate_bin_3),
                                       length(which(jun_jul_bin$recessionrate_bin_4))/length(jun_jul_bin$recessionrate_bin_4),
                                       length(which(jun_jul_bin$recessionrate_bin_5))/length(jun_jul_bin$recessionrate_bin_5))

colnames(rr_30d_prob_natural_jun_jul) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_natural_aug_sep <- cbind(length(which(aug_sep_bin$recessionrate_bin_1))/length(aug_sep_bin$recessionrate_bin_1),
                                       length(which(aug_sep_bin$recessionrate_bin_2))/length(aug_sep_bin$recessionrate_bin_2),
                                       length(which(aug_sep_bin$recessionrate_bin_3))/length(aug_sep_bin$recessionrate_bin_3),
                                       length(which(aug_sep_bin$recessionrate_bin_4))/length(aug_sep_bin$recessionrate_bin_4),
                                       length(which(aug_sep_bin$recessionrate_bin_5))/length(aug_sep_bin$recessionrate_bin_5))

colnames(rr_30d_prob_natural_aug_sep) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_natural_discrete <- rbind(rr_30d_prob_natural_apr_may,rr_30d_prob_natural_jun_jul,rr_30d_prob_natural_aug_sep)
row.names(rr_30d_prob_natural_discrete) <- c("apr_may","jun_jul","aug_sep")
rr_30d_prob_natural_discrete <- rr_30d_prob_natural_discrete/rowSums(rr_30d_prob_natural_discrete)
```

Calculates the probability of 30-day recession rate ranges for the scenario 1 flow scenario and discrete time state (April-May, June-July, August-September).
```{r}

apr_may_bin <- rr_30d_bin_scenario1[months(rr_30d_bin_scenario1$date) %in% month.name[4:5],]
jun_jul_bin <- rr_30d_bin_scenario1[months(rr_30d_bin_scenario1$date) %in% month.name[6:7],]
aug_sep_bin <- rr_30d_bin_scenario1[months(rr_30d_bin_scenario1$date) %in% month.name[8:9],]

rr_30d_prob_scenario1_apr_may <- cbind(length(which(apr_may_bin$recessionrate_bin_1))/length(apr_may_bin$recessionrate_bin_1),
                                       length(which(apr_may_bin$recessionrate_bin_2))/length(apr_may_bin$recessionrate_bin_2),
                                       length(which(apr_may_bin$recessionrate_bin_3))/length(apr_may_bin$recessionrate_bin_3),
                                       length(which(apr_may_bin$recessionrate_bin_4))/length(apr_may_bin$recessionrate_bin_4),
                                       length(which(apr_may_bin$recessionrate_bin_5))/length(apr_may_bin$recessionrate_bin_5))

colnames(rr_30d_prob_scenario1_apr_may) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_scenario1_jun_jul <- cbind(length(which(jun_jul_bin$recessionrate_bin_1))/length(jun_jul_bin$recessionrate_bin_1),
                                       length(which(jun_jul_bin$recessionrate_bin_2))/length(jun_jul_bin$recessionrate_bin_2),
                                       length(which(jun_jul_bin$recessionrate_bin_3))/length(jun_jul_bin$recessionrate_bin_3),
                                       length(which(jun_jul_bin$recessionrate_bin_4))/length(jun_jul_bin$recessionrate_bin_4),
                                       length(which(jun_jul_bin$recessionrate_bin_5))/length(jun_jul_bin$recessionrate_bin_5))

colnames(rr_30d_prob_scenario1_jun_jul) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_scenario1_aug_sep <- cbind(length(which(aug_sep_bin$recessionrate_bin_1))/length(aug_sep_bin$recessionrate_bin_1),
                                       length(which(aug_sep_bin$recessionrate_bin_2))/length(aug_sep_bin$recessionrate_bin_2),
                                       length(which(aug_sep_bin$recessionrate_bin_3))/length(aug_sep_bin$recessionrate_bin_3),
                                       length(which(aug_sep_bin$recessionrate_bin_4))/length(aug_sep_bin$recessionrate_bin_4),
                                       length(which(aug_sep_bin$recessionrate_bin_5))/length(aug_sep_bin$recessionrate_bin_5))

colnames(rr_30d_prob_scenario1_aug_sep) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_scenario1_discrete <- rbind(rr_30d_prob_scenario1_apr_may,rr_30d_prob_scenario1_jun_jul,rr_30d_prob_scenario1_aug_sep)
row.names(rr_30d_prob_scenario1_discrete) <- c("apr_may","jun_jul","aug_sep")
rr_30d_prob_scenario1_discrete <- rr_30d_prob_scenario1_discrete/rowSums(rr_30d_prob_scenario1_discrete)
```

Calculates the probability of 30-day recession rate ranges for the scenario 2 flow scenario and discrete time state (April-May, June-July, August-September).
```{r}

apr_may_bin <- rr_30d_bin_scenario2[months(rr_30d_bin_scenario2$date) %in% month.name[4:5],]
jun_jul_bin <- rr_30d_bin_scenario2[months(rr_30d_bin_scenario2$date) %in% month.name[6:7],]
aug_sep_bin <- rr_30d_bin_scenario2[months(rr_30d_bin_scenario2$date) %in% month.name[8:9],]

rr_30d_prob_scenario2_apr_may <- cbind(length(which(apr_may_bin$recessionrate_bin_1))/length(apr_may_bin$recessionrate_bin_1),
                                       length(which(apr_may_bin$recessionrate_bin_2))/length(apr_may_bin$recessionrate_bin_2),
                                       length(which(apr_may_bin$recessionrate_bin_3))/length(apr_may_bin$recessionrate_bin_3),
                                       length(which(apr_may_bin$recessionrate_bin_4))/length(apr_may_bin$recessionrate_bin_4),
                                       length(which(apr_may_bin$recessionrate_bin_5))/length(apr_may_bin$recessionrate_bin_5))

colnames(rr_30d_prob_scenario2_apr_may) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_scenario2_jun_jul <- cbind(length(which(jun_jul_bin$recessionrate_bin_1))/length(jun_jul_bin$recessionrate_bin_1),
                                       length(which(jun_jul_bin$recessionrate_bin_2))/length(jun_jul_bin$recessionrate_bin_2),
                                       length(which(jun_jul_bin$recessionrate_bin_3))/length(jun_jul_bin$recessionrate_bin_3),
                                       length(which(jun_jul_bin$recessionrate_bin_4))/length(jun_jul_bin$recessionrate_bin_4),
                                       length(which(jun_jul_bin$recessionrate_bin_5))/length(jun_jul_bin$recessionrate_bin_5))

colnames(rr_30d_prob_scenario2_jun_jul) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_scenario2_aug_sep <- cbind(length(which(aug_sep_bin$recessionrate_bin_1))/length(aug_sep_bin$recessionrate_bin_1),
                                       length(which(aug_sep_bin$recessionrate_bin_2))/length(aug_sep_bin$recessionrate_bin_2),
                                       length(which(aug_sep_bin$recessionrate_bin_3))/length(aug_sep_bin$recessionrate_bin_3),
                                       length(which(aug_sep_bin$recessionrate_bin_4))/length(aug_sep_bin$recessionrate_bin_4),
                                       length(which(aug_sep_bin$recessionrate_bin_5))/length(aug_sep_bin$recessionrate_bin_5))

colnames(rr_30d_prob_scenario2_aug_sep) <- c("recessionrate_bin_1",
                                           "recessionrate_bin_2",
                                           "recessionrate_bin_3",
                                           "recessionrate_bin_4",
                                           "recessionrate_bin_5")

rr_30d_prob_scenario2_discrete <- rbind(rr_30d_prob_scenario2_apr_may,rr_30d_prob_scenario2_jun_jul,rr_30d_prob_scenario2_aug_sep)
row.names(rr_30d_prob_scenario2_discrete) <- c("apr_may","jun_jul","aug_sep")
rr_30d_prob_scenario2_discrete <- rr_30d_prob_scenario2_discrete/rowSums(rr_30d_prob_scenario2_discrete)
```

#### Calculate probabilities for bed shear/scour####
To be potential developed once historical model/process has been recreated.
```{r}



```

#### Calculate probabilities for gw ####
To be potential developed once historical model/process has been recreated.
```{r}



```


##References##

Morrison, R.R., Stone, M.C., 2014. Spatially implemented Bayesian network model to assess environmental impacts of water management. Water Resources Research 50, 81078124. https://doi.org/10.1002/2014WR015600

Cairns, Jr., J. (Ed.), Franklin, J., Bruns, D., Daniels, W., Ehrlich, A., Gore, J., Grunwald, C., Inouye, D., Klose, P., Louda, S., Maguire, L., Shabman, L., Toth, L., Willard, D., Zedler, J., Jordan, III, W., Bradshaw, A. (1994). Rehabilitating Damaged Ecosystems. Boca Raton: CRC Press ****hydrologic restoration criteria - 0.3m/month***

http://www.stat.umn.edu/geyer/old/5101/rlook.html
